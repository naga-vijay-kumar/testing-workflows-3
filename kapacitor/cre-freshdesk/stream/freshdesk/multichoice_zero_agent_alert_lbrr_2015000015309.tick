stream
  |from()
    .database('cre-freshdesk')
    .measurement('cre_cf_sherlock_ticket_agent_update_total')
  |where(lambda: "is_automation" == 'true' AND "group_id" == '2015000015309' AND "account_id" == '986130')
  |derivative('counter')
    .unit(20m)
    .nonNegative()
    .as('updates')
  |window()
    .period(10m)
    .every(10m)
  |mean('updates')
    .as('updates')
  |stateDuration(lambda: "updates" == 0)
    .unit(1m)
  |alert()
    .message('[ {{ .Time }} ] [multichoice_zero_agent_alert_lbrr_2015000015309] [ Zero Agent assignments for the last 10 minutes for group with id = 2015000015309 ] {{ .Level }}')
    .warn(lambda: "state_duration" >= 15 AND ((hour("time") > 5 OR (hour("time") == 5 AND minute("time") > 40)) AND ((hour("time") == 20 AND minute("time") < 50) OR (hour("time") < 20))))
    .warnReset(lambda: "state_duration" == 0)
    .stateChangesOnly()
    .topic('cre-freshdesk')